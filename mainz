<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Operational Systems Architecture (AI Powered)</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body {
            margin: 0;
            padding: 0;
            background-color: #0a0c10;
            font-family: 'Inter', sans-serif;
        }
        .node-glow {
            box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
        }
        .custom-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }
        .drag-line {
            pointer-events: none;
            stroke: #fbbf24;
            stroke-width: 2;
            stroke-dasharray: 5,5;
        }
        .pulse-active {
            animation: pulse-ring 2s infinite;
        }
        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        input[type=range] {
            accent-color: #3b82f6;
        }
        .ai-glow {
            box-shadow: 0 0 15px rgba(168, 85, 247, 0.4);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;
        
        // --- Gemini API Helpers ---
        const apiKey = "";
        const callGemini = async (userQuery, systemPrompt) => {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] }
            };

            let delay = 1000;
            for (let i = 0; i < 5; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();
                    if (!response.ok) throw new Error(result.error?.message || "Failed API call");
                    return result.candidates?.[0]?.content?.parts?.[0]?.text;
                } catch (error) {
                    if (i === 4) throw error;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        };

        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                Link: (
                    <>
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" />
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" />
                    </>
                ),
                RotateCcw: (
                    <>
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
                        <path d="M3 3v5h5" />
                    </>
                ),
                Zap: <path d="M13 2 3 14h9l-1 8 10-12h-9l1-8z" />,
                Lock: (
                    <>
                        <rect width="18" height="11" x="3" y="11" rx="2" ry="2" />
                        <path d="M7 11V7a5 5 0 0 1 10 0v4" />
                    </>
                ),
                CheckCircle2: (
                    <>
                        <circle cx="12" cy="12" r="10" />
                        <path d="m9 12 2 2 4-4" />
                    </>
                ),
                Activity: <path d="M22 12h-4l-3 9L9 3l-3 9H2" />,
                TrendingUp: (
                    <>
                        <path d="m22 7-8.5 8.5-5-5L2 17" />
                        <path d="M16 7h6v6" />
                    </>
                ),
                TrendingDown: (
                    <>
                        <path d="m22 17-8.5-8.5-5 5L2 7" />
                        <path d="M16 17h6v-6" />
                    </>
                ),
                Sparkles: (
                    <>
                        <path d="m12 3 1.912 5.813a2 2 0 0 0 1.275 1.275L21 12l-5.813 1.912a2 2 0 0 0-1.275 1.275L12 21l-1.912-5.813a2 2 0 0 0-1.275-1.275L3 12l5.813-1.912a2 2 0 0 0 1.275-1.275L12 3Z" />
                        <path d="M5 3v4" /><path d="M3 5h4" /><path d="M21 17v4" /><path d="M19 19h4" />
                    </>
                ),
                Cpu: <><rect width="16" height="16" x="4" y="4" rx="2" /><rect width="6" height="6" x="9" y="9" rx="1" /><path d="M15 2v2" /><path d="M15 20v2" /><path d="M2 15h2" /><path d="M2 9h2" /><path d="M20 15h2" /><path d="M20 9h2" /><path d="M9 2v2" /><path d="M9 20v2" /></>,
                Loader: <path d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83" />
            };

            return (
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width={size}
                    height={size}
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    className={className}
                >
                    {icons[name] || null}
                </svg>
            );
        };

        const INITIAL_NODES = [
            { id: 'training', label: 'Training', x: 50, y: 90, branch: 'core', desc: 'Foundational onboarding and skill development.', type: 'root', impactNote: 'Baseline skill level for all agent interactions.', value: 75 },
            { id: 'sl', label: 'SL (%)', x: 50, y: 65, branch: 'sl', desc: 'Service Level target performance (e.g. 80/20).', impactNote: 'Proper training ensures agents handle calls correctly.', value: 80 },
            { id: 'csat', label: 'CSAT/DSAT', x: 50, y: 40, branch: 'outcome', desc: 'Direct customer feedback scores.', impactNote: 'Responsive Service Levels minimize customer wait-time frustration.', value: 85 },
            { id: 'nps', label: 'NPS', x: 50, y: 15, branch: 'outcome', desc: 'Net Promoter Score - Brand Loyalty.', impactNote: 'Sustained high CSAT converts one-time callers into loyal advocates.', value: 40 },
            { id: 'occupancy', label: 'Occupancy', x: 35, y: 80, branch: 'ops', desc: 'Time agents spend on-call vs waiting.', impactNote: 'Trained agents navigate tools with muscle memory.', value: 70 },
            { id: 'shrinkage', label: 'Shrink %', x: 20, y: 85, branch: 'ops', desc: 'Internal meetings, breaks, and coaching.', impactNote: 'Comprehensive training reduces emergency coaching needs.', value: 15 },
            { id: 'staffed_req', label: 'Staffed to Req', x: 25, y: 70, branch: 'ops', desc: 'Alignment between scheduled and required staff.', impactNote: 'Training allows for flexible cross-skilling.', value: 92 },
            { id: 'aht', label: 'AHT/cAHT', x: 15, y: 60, branch: 'ops', desc: 'Average Handling Time.', impactNote: 'Mastery allows for efficient call durations.', value: 300 },
            { id: 'handled_fc', label: '# Handled', x: 10, y: 45, branch: 'ops', desc: 'Total volume throughput.', impactNote: 'Operational speed increases volume processed.', value: 500 },
            { id: 'overflow', label: 'Overflow %', x: 25, y: 35, branch: 'ops', desc: 'Calls pushed to backup queues.', impactNote: 'Capacity keeps volume in-house.', value: 5 },
            { id: 'qa_monitors', label: 'QA Monitorings', x: 65, y: 80, branch: 'qa', desc: 'Quality assurance evaluations.', impactNote: 'Training sets the target for execution.', value: 20 },
            { id: 'qa_calibration', label: 'QA Calibration', x: 80, y: 85, branch: 'qa', desc: 'Score alignment between reviewers.', impactNote: 'Clear training serves as the source of truth.', value: 95 },
            { id: 'cc_score', label: 'CC Score %', x: 75, y: 70, branch: 'qa', desc: 'Customer Connection effectiveness.', impactNote: 'Insights highlight specific training gaps.', value: 88 },
            { id: 'bc_score', label: 'BC Score %', x: 85, y: 60, branch: 'qa', desc: 'Compliance and policy adherence.', impactNote: 'Regular QA checks ensure compliance remains in practice.', value: 98 },
            { id: 'ec_score', label: 'EC Score %', x: 90, y: 45, branch: 'qa', desc: 'Experience Consistency ratings.', impactNote: 'Standardized QA guarantees standard experiences.', value: 90 },
            { id: 'surveys', label: '# Surveys', x: 75, y: 35, branch: 'qa', desc: 'Feedback volume collection.', impactNote: 'High quality increases likelihood of participation.', value: 120 },
        ];

        const INITIAL_CONNECTIONS = [
            ['training', 'sl'], ['sl', 'csat'], ['csat', 'nps'],
            ['training', 'occupancy'], ['occupancy', 'shrinkage'], ['occupancy', 'staffed_req'],
            ['staffed_req', 'aht'], ['aht', 'handled_fc'], ['handled_fc', 'overflow'],
            ['overflow', 'csat'],
            ['training', 'qa_monitors'], ['qa_monitors', 'qa_calibration'], ['qa_monitors', 'cc_score'],
            ['cc_score', 'bc_score'], ['bc_score', 'ec_score'], ['ec_score', 'surveys'],
            ['surveys', 'csat']
        ];

        function App() {
            const [nodes, setNodes] = useState(INITIAL_NODES);
            const [connections, setConnections] = useState(INITIAL_CONNECTIONS);
            const [activeNodes, setActiveNodes] = useState(['training']);
            const [selectedNode, setSelectedNode] = useState(null);
            
            // --- AI State ---
            const [aiLoading, setAiLoading] = useState(false);
            const [aiAnalysis, setAiAnalysis] = useState("");
            const [stressTest, setStressTest] = useState(null);

            const [dragSource, setDragSource] = useState(null);
            const [mousePos, setMousePos] = useState({ x: 0, y: 0 });
            const containerRef = useRef(null);

            // Simulation Logic: Propagate impacts
            const updateNodeValue = useCallback((nodeId, newValue) => {
                setNodes(currentNodes => {
                    const updatedNodes = [...currentNodes];
                    const nodeIndex = updatedNodes.findIndex(n => n.id === nodeId);
                    if (nodeIndex === -1) return currentNodes;
                    
                    const oldValue = updatedNodes[nodeIndex].value;
                    updatedNodes[nodeIndex] = { ...updatedNodes[nodeIndex], value: newValue };

                    const children = connections.filter(conn => conn[0] === nodeId).map(conn => conn[1]);
                    const deltaRatio = newValue / (oldValue || 1);

                    children.forEach(childId => {
                        const childIndex = updatedNodes.findIndex(n => n.id === childId);
                        if (childIndex !== -1) {
                            const childValue = updatedNodes[childIndex].value;
                            const impactFactor = 0.5;
                            const newChildValue = childValue * (1 + (deltaRatio - 1) * impactFactor);
                            updatedNodes[childIndex] = { ...updatedNodes[childIndex], value: Math.round(newChildValue * 10) / 10 };
                        }
                    });

                    return updatedNodes;
                });
            }, [connections]);

            // --- AI Logic ---
            const askAiAdvisor = async () => {
                setAiLoading(true);
                const activeMetrics = nodes.filter(n => activeNodes.includes(n.id)).map(n => `${n.label}: ${n.value}`).join(", ");
                const prompt = `Act as an expert Contact Center Operations Manager. Given these active metrics and their current values: ${activeMetrics}, provide 3 concise strategic focus points to improve NPS. Keep it professional and brief.`;
                const systemPrompt = "You are a strategic AI analyst for a complex operational dashboard. You identify bottlenecks and provide architectural advice.";
                
                try {
                    const advice = await callGemini(prompt, systemPrompt);
                    setAiAnalysis(advice);
                } catch (err) {
                    setAiAnalysis("Error connecting to AI Advisor. Check network and try again.");
                } finally {
                    setAiLoading(false);
                }
            };

            const runStressTest = async () => {
                setAiLoading(true);
                setStressTest(null);
                const activeMetrics = activeNodes.join(", ");
                const prompt = `Generate a realistic operational 'Stress Test' scenario (like a system outage, viral trend, or staffing crisis) that would test an architecture consisting of these active modules: ${activeMetrics}. Describe the scenario and provide a risk assessment score out of 10.`;
                
                try {
                    const test = await callGemini(prompt, "You are an operational disaster simulation engine. You create complex, realistic failure scenarios.");
                    setStressTest(test);
                } catch (err) {
                    setStressTest("Failed to generate simulation.");
                } finally {
                    setAiLoading(false);
                }
            };

            const canBeActivated = (nodeId) => {
                if (activeNodes.includes(nodeId)) return true;
                if (nodeId === 'training') return true;
                const parents = connections.filter(c => c[1] === nodeId).map(c => c[0]);
                return parents.some(p => activeNodes.includes(p));
            };

            const handleBackgroundClick = (e) => {
                if (e.target === e.currentTarget || e.target.id === "svg-overlay") {
                    setSelectedNode(null);
                    setAiAnalysis("");
                }
            };

            const handleNodeClick = (e, node) => {
                e.stopPropagation();
                setSelectedNode(node);
                if (!activeNodes.includes(node.id) && canBeActivated(node.id)) {
                    setActiveNodes(prev => [...prev, node.id]);
                }
            };

            const handleMouseDown = (e, nodeId) => {
                setDragSource(nodeId);
                const rect = containerRef.current.getBoundingClientRect();
                setMousePos({ x: e.clientX - rect.left, y: e.clientY - rect.top });
            };

            const handleMouseMove = (e) => {
                if (!dragSource) return;
                const rect = containerRef.current.getBoundingClientRect();
                setMousePos({ x: e.clientX - rect.left, y: e.clientY - rect.top });
            };

            const handleMouseUp = (e, targetId) => {
                if (dragSource && targetId && dragSource !== targetId) {
                    const existsIdx = connections.findIndex(c => 
                        (c[0] === dragSource && c[1] === targetId) || 
                        (c[0] === targetId && c[1] === dragSource)
                    );
                    if (existsIdx > -1) {
                        setConnections(prev => prev.filter((_, i) => i !== existsIdx));
                    } else {
                        setConnections(prev => [...prev, [dragSource, targetId]]);
                    }
                }
                setDragSource(null);
            };

            const getParentNode = (nodeId) => {
                const conn = connections.find(c => c[1] === nodeId && activeNodes.includes(c[0]));
                return conn ? nodes.find(n => n.id === conn[0]) : null;
            };

            const currentNode = nodes.find(n => n.id === selectedNode?.id);

            return (
                <div 
                    className="flex h-screen w-full bg-[#0a0c10] text-slate-200 overflow-hidden select-none relative"
                    onMouseMove={handleMouseMove}
                    onMouseUp={() => setDragSource(null)}
                    onClick={handleBackgroundClick}
                >
                    <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,_#1a1f2e_0%,_#0a0c10_85%)]" />
                    
                    {/* UI Header */}
                    <div className="absolute top-0 left-0 w-full p-8 flex justify-between items-start z-20 pointer-events-none">
                        <div className="pointer-events-auto">
                            <h1 className="text-3xl font-black tracking-tighter text-white italic drop-shadow-[0_0_15px_rgba(59,130,246,0.5)]">
                                OPS <span className="text-blue-500 uppercase">Simulator</span>
                            </h1>
                            <div className="flex items-center gap-3 mt-1 bg-black/60 backdrop-blur-md px-4 py-1.5 rounded-full border border-white/10 w-fit">
                                <span className="text-[10px] font-bold text-slate-300 uppercase tracking-widest flex items-center gap-2">
                                    <div className="w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse" />
                                    AI-Powered Systems Analysis Active
                                </span>
                            </div>
                        </div>
                        
                        <div className="flex gap-4 pointer-events-auto">
                            <button 
                                onClick={runStressTest}
                                className="px-5 py-2.5 bg-purple-600/20 hover:bg-purple-600/30 text-purple-400 border border-purple-500/30 rounded-2xl backdrop-blur-md transition-all flex items-center gap-2 ai-glow"
                            >
                                <Icon name="Cpu" size={18} className={aiLoading ? "animate-spin" : ""} />
                                <span className="text-xs font-black uppercase tracking-widest">✨ Run Stress Test</span>
                            </button>
                            
                            <button 
                                onClick={(e) => {
                                    e.stopPropagation();
                                    setConnections(INITIAL_CONNECTIONS); 
                                    setActiveNodes(['training']);
                                    setNodes(INITIAL_NODES);
                                    setSelectedNode(null);
                                    setStressTest(null);
                                    setAiAnalysis("");
                                }} 
                                className="p-3 bg-white/5 border border-white/10 rounded-full hover:bg-white/10 text-red-400 shadow-xl transition-all"
                                title="Reset Map"
                            >
                                <Icon name="RotateCcw" size={20} />
                            </button>
                        </div>
                    </div>

                    {/* Infrastructure Canvas */}
                    <div ref={containerRef} className={`relative h-full flex items-center justify-center transition-all duration-500 ${selectedNode ? 'w-[calc(100%-380px)] ml-0' : 'w-full mx-auto'}`}>
                        {stressTest && (
                            <div className="absolute top-32 max-w-lg bg-purple-900/20 border border-purple-500/30 p-6 rounded-3xl backdrop-blur-xl z-10 animate-in fade-in zoom-in slide-in-from-top-4">
                                <div className="flex items-center justify-between mb-4">
                                    <h4 className="text-purple-400 font-black text-xs uppercase tracking-[0.3em]">Operational Stress Test Result</h4>
                                    <button onClick={() => setStressTest(null)} className="text-purple-500 hover:text-white"><Icon name="RotateCcw" size={14} className="rotate-45" /></button>
                                </div>
                                <p className="text-sm text-slate-300 leading-relaxed italic pr-4">{stressTest}</p>
                            </div>
                        )}

                        <svg id="svg-overlay" className="absolute inset-0 w-full h-full pointer-events-none overflow-visible">
                            <filter id="glow"><feGaussianBlur stdDeviation="3" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
                            
                            {connections.map(([fromId, toId], i) => {
                                const from = nodes.find(n => n.id === fromId);
                                const to = nodes.find(n => n.id === toId);
                                if (!from || !to) return null;
                                const active = activeNodes.includes(fromId) && activeNodes.includes(toId);
                                return (
                                    <line key={i} x1={`${from.x}%`} y1={`${from.y}%`} x2={`${to.x}%`} y2={`${to.y}%`} 
                                        stroke={active ? '#3b82f6' : '#1e293b'} strokeWidth={active ? 3 : 1.5} 
                                        className="transition-all duration-700"
                                        filter={active ? 'url(#glow)' : ''}
                                    />
                                );
                            })}

                            {dragSource && (
                                <line x1={`${nodes.find(n => n.id === dragSource).x}%`} y1={`${nodes.find(n => n.id === dragSource).y}%`} x2={mousePos.x} y2={mousePos.y} className="drag-line" />
                            )}
                        </svg>

                        {nodes.map(node => {
                            const active = activeNodes.includes(node.id);
                            const selected = selectedNode?.id === node.id;
                            const available = canBeActivated(node.id);
                            
                            return (
                                <div key={node.id} 
                                    className="absolute -translate-x-1/2 -translate-y-1/2 cursor-pointer transition-transform duration-300 hover:scale-110 z-10" 
                                    style={{ left: `${node.x}%`, top: `${node.y}%` }}
                                    onMouseDown={(e) => handleMouseDown(e, node.id)}
                                    onMouseUp={(e) => handleMouseUp(e, node.id)}
                                    onClick={(e) => handleNodeClick(e, node)}
                                >
                                    <div className={`w-14 h-14 rounded-full flex flex-col items-center justify-center transition-all duration-500 border-2 ${
                                        active ? 'bg-blue-600/10 border-blue-400 node-glow pulse-active' :
                                        available ? 'bg-white/10 border-white/40' :
                                        'bg-black/80 border-white/5 opacity-40 grayscale'
                                    } ${selected ? 'scale-125 ring-4 ring-blue-500/20 border-white z-20 shadow-[0_0_40px_rgba(59,130,246,0.3)]' : ''}`}>
                                        
                                        <div className={`absolute -top-10 text-[9px] font-black uppercase tracking-[0.2em] transition-colors whitespace-nowrap ${
                                            active ? 'text-white' : available ? 'text-slate-300' : 'text-slate-600'
                                        }`}>
                                            {node.label}
                                        </div>

                                        {node.type === 'root' ? (
                                            <Icon name="Zap" size={18} className="text-amber-400 fill-amber-400" />
                                        ) : (
                                            <div className="flex flex-col items-center">
                                                <div className={`text-[10px] font-bold mb-0.5 ${active ? 'text-blue-400' : 'text-slate-500'}`}>
                                                    {Math.round(node.value)}
                                                </div>
                                                <div className="w-6 h-1 bg-white/10 rounded-full overflow-hidden">
                                                    <div className={`h-full transition-all duration-1000 ${active ? 'bg-blue-500' : 'bg-slate-700'}`} style={{ width: `${Math.min(100, node.value)}%` }} />
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {/* SIDE ANALYSIS PANEL (AI Powered) */}
                    <div 
                        className={`fixed right-0 top-0 h-full w-[380px] bg-[#0f1218]/95 border-l border-white/10 p-8 transition-transform duration-500 transform backdrop-blur-3xl z-40 flex flex-col shadow-2xl ${selectedNode ? 'translate-x-0' : 'translate-x-full'}`}
                        onClick={(e) => e.stopPropagation()}
                    >
                        {currentNode && (
                            <div className="h-full flex flex-col custom-scroll overflow-y-auto pr-2">
                                <div className="flex justify-between items-start mb-8">
                                    <div className="flex-1">
                                        <h3 className="text-2xl font-black text-white italic tracking-tighter uppercase leading-none pr-4">{currentNode.label}</h3>
                                        <div className="flex items-center gap-2 mt-3">
                                            <span className={`text-[9px] font-bold px-2 py-0.5 rounded uppercase tracking-widest ${
                                                activeNodes.includes(currentNode.id) ? 'bg-blue-500/20 text-blue-400 border border-blue-500/30' : 'bg-slate-800 text-slate-500'
                                            }`}>
                                                {activeNodes.includes(currentNode.id) ? 'Active' : 'Offline'}
                                            </span>
                                        </div>
                                    </div>
                                    <button onClick={() => setSelectedNode(null)} className="text-slate-500 hover:text-white"><Icon name="RotateCcw" size={18} className="rotate-45" /></button>
                                </div>

                                <div className="mb-10 p-5 bg-blue-500/5 rounded-2xl border border-blue-500/10">
                                    <div className="flex justify-between items-center mb-4">
                                        <label className="text-[10px] font-black text-blue-400 uppercase tracking-[0.2em]">Operational Level</label>
                                        <span className="text-xl font-mono font-black text-blue-400">{Math.round(currentNode.value)}</span>
                                    </div>
                                    <input 
                                        type="range" min="0" max="200" value={currentNode.value}
                                        onChange={(e) => updateNodeValue(currentNode.id, parseFloat(e.target.value))}
                                        className="w-full h-1.5 bg-white/10 rounded-full appearance-none cursor-pointer"
                                    />
                                </div>

                                <div className="space-y-6 flex-1">
                                    <div>
                                        <div className="flex items-center gap-2 mb-3 text-slate-500">
                                            <Icon name="Activity" size={14} />
                                            <label className="text-[9px] font-bold uppercase tracking-widest">Base Description</label>
                                        </div>
                                        <p className="text-sm text-slate-400 leading-relaxed font-medium bg-white/[0.02] p-4 rounded-xl border border-white/[0.05]">
                                            {currentNode.desc}
                                        </p>
                                    </div>

                                    <div className="pt-4 border-t border-white/5">
                                        <div className="flex items-center justify-between mb-4">
                                            <div className="flex items-center gap-2 text-purple-400">
                                                <Icon name="Sparkles" size={14} />
                                                <label className="text-[10px] font-black uppercase tracking-widest">✨ Strategic AI Advisor</label>
                                            </div>
                                            {!aiAnalysis && (
                                                <button 
                                                    onClick={askAiAdvisor}
                                                    disabled={aiLoading}
                                                    className="text-[9px] font-bold text-purple-500 hover:text-purple-400 uppercase tracking-widest bg-purple-500/10 px-2 py-1 rounded border border-purple-500/20"
                                                >
                                                    {aiLoading ? "Analyzing..." : "Ask AI"}
                                                </button>
                                            )}
                                        </div>
                                        
                                        {aiAnalysis ? (
                                            <div className="p-5 bg-purple-900/10 rounded-2xl border border-purple-500/20 animate-in fade-in slide-in-from-bottom-2">
                                                <p className="text-xs text-slate-300 leading-relaxed italic whitespace-pre-wrap">
                                                    {aiAnalysis}
                                                </p>
                                                <button onClick={() => setAiAnalysis("")} className="mt-4 text-[9px] font-bold text-slate-500 hover:text-white uppercase tracking-widest">Reset Analysis</button>
                                            </div>
                                        ) : aiLoading ? (
                                            <div className="flex flex-col items-center justify-center py-10 text-slate-600 gap-3">
                                                <Icon name="Loader" className="animate-spin" />
                                                <span className="text-[10px] uppercase font-black tracking-widest">Scanning Metrics...</span>
                                            </div>
                                        ) : (
                                            <div className="p-4 rounded-xl border border-dashed border-white/10 text-center text-slate-600 text-[10px] uppercase font-bold">
                                                Click "Ask AI" for strategic insights
                                            </div>
                                        )}
                                    </div>
                                </div>

                                <div className="mt-8 pt-6 border-t border-white/5 opacity-50 text-[9px] font-bold tracking-widest uppercase text-slate-600 flex justify-between">
                                    <span>AI Engine: Gemini 2.5</span>
                                    <span>Sync: Stable</span>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
